"use client";

import { useState, useRef, useEffect } from "react";

interface EmojiPickerProps {
  onSelect: (emoji: string) => void;
  isOpen: boolean;
  onClose: () => void;
}

// Common emoji categories
const EMOJI_CATEGORIES = {
  "Smileys": ["ğŸ˜€", "ğŸ˜ƒ", "ğŸ˜„", "ğŸ˜", "ğŸ˜†", "ğŸ˜…", "ğŸ¤£", "ğŸ˜‚", "ğŸ™‚", "ğŸ™ƒ", "ğŸ˜‰", "ğŸ˜Š", "ğŸ˜‡", "ğŸ¥°", "ğŸ˜", "ğŸ¤©", "ğŸ˜˜", "ğŸ˜—", "ğŸ˜š", "ğŸ˜™", "ğŸ¥²", "ğŸ˜‹", "ğŸ˜›", "ğŸ˜œ", "ğŸ¤ª", "ğŸ˜", "ğŸ¤‘", "ğŸ¤—", "ğŸ¤­", "ğŸ¤«", "ğŸ¤”", "ğŸ¤", "ğŸ¤¨", "ğŸ˜", "ğŸ˜‘", "ğŸ˜¶", "ğŸ˜", "ğŸ˜’", "ğŸ™„", "ğŸ˜¬"],
  "Gestures": ["ğŸ‘", "ğŸ‘", "ğŸ‘Œ", "ğŸ¤Œ", "ğŸ¤", "âœŒï¸", "ğŸ¤", "ğŸ¤Ÿ", "ğŸ¤˜", "ğŸ¤™", "ğŸ‘ˆ", "ğŸ‘‰", "ğŸ‘†", "ğŸ‘‡", "â˜ï¸", "ğŸ‘‹", "ğŸ¤š", "ğŸ–ï¸", "âœ‹", "ğŸ––", "ğŸ‘", "ğŸ™Œ", "ğŸ‘", "ğŸ¤²", "ğŸ¤", "ğŸ™", "âœï¸", "ğŸ’ª", "ğŸ¦µ", "ğŸ¦¶"],
  "Hearts": ["â¤ï¸", "ğŸ§¡", "ğŸ’›", "ğŸ’š", "ğŸ’™", "ğŸ’œ", "ğŸ–¤", "ğŸ¤", "ğŸ¤", "ğŸ’”", "â£ï¸", "ğŸ’•", "ğŸ’", "ğŸ’“", "ğŸ’—", "ğŸ’–", "ğŸ’˜", "ğŸ’", "ğŸ’Ÿ", "â™¥ï¸", "ğŸ«¶", "ğŸ©·", "ğŸ©µ", "ğŸ©¶"],
  "Faces": ["ğŸ˜¢", "ğŸ˜­", "ğŸ˜¤", "ğŸ˜ ", "ğŸ˜¡", "ğŸ¤¬", "ğŸ¤¯", "ğŸ˜³", "ğŸ¥µ", "ğŸ¥¶", "ğŸ˜±", "ğŸ˜¨", "ğŸ˜°", "ğŸ˜¥", "ğŸ˜“", "ğŸ¤—", "ğŸ¤”", "ğŸ«£", "ğŸ¤­", "ğŸ«¢", "ğŸ«¡", "ğŸ¤«", "ğŸ« ", "ğŸ¤¥", "ğŸ˜¶", "ğŸ˜¶â€ğŸŒ«ï¸", "ğŸ˜", "ğŸ˜‘", "ğŸ˜¬", "ğŸ™„"],
  "Animals": ["ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹", "ğŸ°", "ğŸ¦Š", "ğŸ»", "ğŸ¼", "ğŸ¨", "ğŸ¯", "ğŸ¦", "ğŸ®", "ğŸ·", "ğŸ¸", "ğŸµ", "ğŸ”", "ğŸ§", "ğŸ¦", "ğŸ¤", "ğŸ¦†", "ğŸ¦…", "ğŸ¦‰", "ğŸ¦‡", "ğŸº", "ğŸ—", "ğŸ´", "ğŸ¦„", "ğŸ", "ğŸª±", "ğŸ›"],
  "Nature": ["ğŸŒ¸", "ğŸ’®", "ğŸµï¸", "ğŸŒ¹", "ğŸ¥€", "ğŸŒº", "ğŸŒ»", "ğŸŒ¼", "ğŸŒ·", "ğŸŒ±", "ğŸª´", "ğŸŒ²", "ğŸŒ³", "ğŸŒ´", "ğŸŒµ", "ğŸŒ¾", "ğŸŒ¿", "â˜˜ï¸", "ğŸ€", "ğŸ", "ğŸ‚", "ğŸƒ", "ğŸª¹", "ğŸªº", "ğŸ„", "ğŸŒ", "ğŸŒ", "ğŸŒ", "ğŸŒ•", "ğŸŒ™"],
  "Food": ["ğŸ", "ğŸ", "ğŸŠ", "ğŸ‹", "ğŸŒ", "ğŸ‰", "ğŸ‡", "ğŸ“", "ğŸ«", "ğŸˆ", "ğŸ’", "ğŸ‘", "ğŸ¥­", "ğŸ", "ğŸ¥¥", "ğŸ¥", "ğŸ…", "ğŸ¥‘", "ğŸ†", "ğŸ¥¦", "ğŸ¥¬", "ğŸ¥’", "ğŸŒ¶ï¸", "ğŸ«‘", "ğŸŒ½", "ğŸ¥•", "ğŸ«’", "ğŸ§„", "ğŸ§…", "ğŸ¥”"],
  "Activities": ["âš½", "ğŸ€", "ğŸˆ", "âš¾", "ğŸ¥", "ğŸ¾", "ğŸ", "ğŸ‰", "ğŸ¥", "ğŸ±", "ğŸª€", "ğŸ“", "ğŸ¸", "ğŸ’", "ğŸ‘", "ğŸ¥", "ğŸ", "ğŸªƒ", "ğŸ¥…", "â›³", "ğŸª", "ğŸ¹", "ğŸ£", "ğŸ¤¿", "ğŸ¥Š", "ğŸ¥‹", "ğŸ½", "ğŸ›¹", "ğŸ›¼", "ğŸ›·"],
  "Objects": ["ğŸ’¡", "ğŸ”¦", "ğŸ®", "ğŸª”", "ğŸ“±", "ğŸ’»", "âŒ¨ï¸", "ğŸ–¥ï¸", "ğŸ–¨ï¸", "ğŸ–±ï¸", "ğŸ–²ï¸", "ğŸ’¾", "ğŸ’¿", "ğŸ“€", "ğŸ¥", "ğŸï¸", "ğŸ“½ï¸", "ğŸ“º", "ğŸ“·", "ğŸ“¸", "ğŸ“¹", "ğŸ“¼", "ğŸ”", "ğŸ”", "ğŸ”¬", "ğŸ”­", "ğŸ“¡", "ğŸ’³", "ğŸ’", "âš™ï¸"],
  "Symbols": ["âœ¨", "â­", "ğŸŒŸ", "ğŸ’«", "âœ´ï¸", "ğŸ”¥", "ğŸ’¥", "ğŸ’¢", "ğŸ’¦", "ğŸ’¨", "ğŸ•³ï¸", "ğŸ’£", "ğŸ’¬", "ğŸ‘ï¸â€ğŸ—¨ï¸", "ğŸ—¨ï¸", "ğŸ—¯ï¸", "ğŸ’­", "ğŸ’¤", "ğŸµ", "ğŸ¶", "ğŸ””", "ğŸ”•", "ğŸ“£", "ğŸ“¢", "ğŸ´", "ğŸš©", "ğŸ³ï¸", "ğŸ³ï¸â€ğŸŒˆ", "ğŸ³ï¸â€âš§ï¸", "ğŸ´â€â˜ ï¸"],
};

export default function EmojiPicker({ onSelect, isOpen, onClose }: EmojiPickerProps) {
  const [activeCategory, setActiveCategory] = useState<string>("Smileys");
  const [searchQuery, setSearchQuery] = useState("");
  const pickerRef = useRef<HTMLDivElement>(null);

  // Close on click outside
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (pickerRef.current && !pickerRef.current.contains(event.target as Node)) {
        onClose();
      }
    };

    if (isOpen) {
      document.addEventListener("mousedown", handleClickOutside);
    }

    return () => {
      document.removeEventListener("mousedown", handleClickOutside);
    };
  }, [isOpen, onClose]);

  // Close on escape
  useEffect(() => {
    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === "Escape") onClose();
    };

    if (isOpen) {
      document.addEventListener("keydown", handleEscape);
    }

    return () => {
      document.removeEventListener("keydown", handleEscape);
    };
  }, [isOpen, onClose]);

  if (!isOpen) return null;

  const categories = Object.keys(EMOJI_CATEGORIES);

  // Filter emojis by search query
  const getFilteredEmojis = () => {
    if (!searchQuery) {
      return EMOJI_CATEGORIES[activeCategory as keyof typeof EMOJI_CATEGORIES];
    }

    // Search across all categories
    const allEmojis: string[] = [];
    Object.values(EMOJI_CATEGORIES).forEach((emojis) => {
      allEmojis.push(...emojis);
    });

    // Simple search - just return all for now since emoji search is complex
    return allEmojis.slice(0, 40);
  };

  const emojis = getFilteredEmojis();

  return (
    <div
      ref={pickerRef}
      className="absolute bottom-full mb-2 right-0 w-[320px] bg-white rounded-2xl shadow-xl border border-black/[0.08] overflow-hidden z-50"
    >
      {/* Search */}
      <div className="p-3 border-b border-black/[0.06]">
        <input
          type="text"
          value={searchQuery}
          onChange={(e) => setSearchQuery(e.target.value)}
          placeholder="Search emojis..."
          className="w-full px-3 py-2 rounded-lg bg-black/[0.04] border-none outline-none font-ui text-sm text-ink placeholder:text-muted/50 focus:ring-2 focus:ring-purple-primary/20"
        />
      </div>

      {/* Category tabs */}
      {!searchQuery && (
        <div className="flex overflow-x-auto px-2 py-2 border-b border-black/[0.06] gap-1 scrollbar-hide">
          {categories.map((category) => (
            <button
              key={category}
              onClick={() => setActiveCategory(category)}
              className={`px-3 py-1.5 rounded-lg font-ui text-xs whitespace-nowrap transition-all ${
                activeCategory === category
                  ? "bg-purple-primary text-white"
                  : "text-muted hover:bg-black/[0.04]"
              }`}
            >
              {category}
            </button>
          ))}
        </div>
      )}

      {/* Emoji grid */}
      <div className="p-2 max-h-[200px] overflow-y-auto">
        <div className="grid grid-cols-8 gap-1">
          {emojis.map((emoji, index) => (
            <button
              key={`${emoji}-${index}`}
              onClick={() => {
                onSelect(emoji);
                onClose();
              }}
              className="w-9 h-9 flex items-center justify-center text-xl hover:bg-black/[0.06] rounded-lg transition-colors"
            >
              {emoji}
            </button>
          ))}
        </div>
      </div>
    </div>
  );
}
